version: "3.7"

services:
  proxy:
    container_name: "${IMAGE_REPO}-proxy"
  app:
    build:
      args:
        BUILD_RELEASE_DATE: ${RELEASE_DATE}
        BUILD_RELEASE_VERSION: ${IMAGE_TAG}
        IMAGE_BASE_NGINX: ${IMAGE_BASE_NGINX}
        PORT_EXPOSE: ${PORT_EXPOSE_PROXY}
      dockerfile: Dockerfile.production
    environment:
      NODE_ENV: production
      VIRTUAL_HOST: ${APP_DOMAIN}
      VIRTUAL_PORT: ${PORT_EXPOSE_PROXY}
    restart: always
